openapi: 3.0.3
info:
  title: AptBooks Backend API
  version: "1.0.0"
  description: Phase 1 API (Foundation + Accounting Kernel)
servers:
  - url: http://localhost:4000
    description: Local
tags:
  - name: Auth
  - name: Users
  - name: Roles
  - name: Permissions
  - name: Settings
  - name: Periods
  - name: Chart of Accounts
  - name: Journals
  - name: Balances

components:
  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  responses:
    Unauthorized:
      description: Unauthorized
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            missingToken:
              value: { error: "Missing bearer token" }
    Forbidden:
      description: Forbidden
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            forbidden:
              value: { error: "Forbidden" }
    NotFound:
      description: Not found
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            notFound:
              value: { error: "Not found" }
    Conflict:
      description: Conflict
      content:
        application/json:
          schema: { $ref: "#/components/schemas/Error" }
          examples:
            conflict:
              value: { error: "Conflict" }

  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
      required: [error]

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, example: "admin@aptbooks.local" }
        password: { type: string, example: "ChangeMe123!" }

    LoginResponse:
      type: object
      required: [accessToken]
      properties:
        accessToken: { type: string, example: "eyJhbGciOi..." }

    Permission:
      type: object
      properties:
        code: { type: string, example: "accounting.journal.read" }
        description: { type: string, example: "Read journals" }
      required: [code]

    Role:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        name: { type: string, example: "Admin" }
        created_at: { type: string, format: date-time }
      required: [id, organization_id, name]

    CreateRoleRequest:
      type: object
      required: [name]
      properties:
        name: { type: string, example: "Accountant" }

    AttachPermissionsRequest:
      type: object
      required: [permissionCodes]
      properties:
        permissionCodes:
          type: array
          items: { type: string }
          example: ["accounting.journal.read", "accounting.journal.create"]

    AttachPermissionsResponse:
      type: object
      properties:
        roleId: { type: string, format: uuid }
        attached:
          type: array
          items: { type: string }

    UserSummary:
      type: object
      properties:
        id: { type: string, format: uuid }
        email: { type: string, example: "user@example.com" }
        status: { type: string, enum: [active, disabled] }
        created_at: { type: string, format: date-time }
      required: [id, email, status]

    CreateUserRequest:
      type: object
      required: [email, password]
      properties:
        email: { type: string, example: "staff@aptbooks.local" }
        password: { type: string, example: "StrongPass123!" }

    AssignRolesRequest:
      type: object
      required: [roleIds]
      properties:
        roleIds:
          type: array
          items: { type: string, format: uuid }

    AssignRolesResponse:
      type: object
      properties:
        userId: { type: string, format: uuid }
        assigned:
          type: array
          items: { type: string, format: uuid }

    Setting:
      type: object
      properties:
        key: { type: string, example: "company_profile" }
        value_json: { type: object, additionalProperties: true }
      required: [key, value_json]

    Period:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        code: { type: string, example: "2026-01" }
        start_date: { type: string, format: date, example: "2026-01-01" }
        end_date: { type: string, format: date, example: "2026-01-31" }
        status: { type: string, enum: [open, closed, locked], example: "open" }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    CreatePeriodRequest:
      type: object
      required: [code, startDate, endDate]
      properties:
        code: { type: string, example: "2026-01" }
        startDate: { type: string, format: date, example: "2026-01-01" }
        endDate: { type: string, format: date, example: "2026-01-31" }

    Account:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        code: { type: string, example: "1000" }
        name: { type: string, example: "Cash" }
        account_type_id: { type: string, format: uuid }
        category_id: { type: string, format: uuid, nullable: true }
        parent_account_id: { type: string, format: uuid, nullable: true }
        is_postable: { type: boolean, example: true }
        status: { type: string, enum: [active, inactive], example: "active" }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    CreateAccountRequest:
      type: object
      required: [code, name, accountTypeCode]
      properties:
        code: { type: string, example: "1200" }
        name: { type: string, example: "Bank" }
        accountTypeCode:
          type: string
          enum: [ASSET, LIABILITY, EQUITY, REVENUE, EXPENSE]
          example: ASSET
        parentAccountId: { type: string, format: uuid, nullable: true }
        isPostable: { type: boolean, default: true }
        status: { type: string, enum: [active, inactive], default: active }

    UpdateAccountRequest:
      type: object
      properties:
        name: { type: string }
        parentAccountId: { type: string, format: uuid, nullable: true }
        isPostable: { type: boolean }
        status: { type: string, enum: [active, inactive] }

    JournalLineCreate:
      type: object
      required: [accountId]
      properties:
        accountId: { type: string, format: uuid }
        description: { type: string, nullable: true }
        debit: { type: number, example: 100 }
        credit: { type: number, example: 0 }

    CreateJournalRequest:
      type: object
      required: [periodId, entryDate, lines]
      properties:
        periodId: { type: string, format: uuid }
        entryDate: { type: string, format: date, example: "2026-01-10" }
        typeCode:
          type: string
          enum: [GENERAL, ADJUSTMENT, CLOSING]
          default: GENERAL
        memo: { type: string, nullable: true }
        idempotencyKey: { type: string, nullable: true, example: "test-001" }
        lines:
          type: array
          minItems: 2
          items: { $ref: "#/components/schemas/JournalLineCreate" }
      example:
        periodId: "00000000-0000-0000-0000-000000000000"
        entryDate: "2026-01-10"
        typeCode: "GENERAL"
        memo: "Test sale"
        idempotencyKey: "test-001"
        lines:
          - accountId: "00000000-0000-0000-0000-000000000000"
            debit: 100
          - accountId: "00000000-0000-0000-0000-000000000000"
            credit: 100

    CreateJournalResponse:
      type: object
      properties:
        journalId: { type: string, format: uuid }
        status: { type: string, enum: [draft], example: "draft" }

    JournalEntry:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        entry_no: { type: integer }
        journal_entry_type_id: { type: string, format: uuid }
        period_id: { type: string, format: uuid }
        entry_date: { type: string, format: date }
        memo: { type: string, nullable: true }
        status: { type: string, enum: [draft, posted, voided] }
        posted_at: { type: string, format: date-time, nullable: true }
        posted_by: { type: string, format: uuid, nullable: true }
        voided_at: { type: string, format: date-time, nullable: true }
        voided_by: { type: string, format: uuid, nullable: true }
        void_reason: { type: string, nullable: true }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    JournalLine:
      type: object
      properties:
        id: { type: string, format: uuid }
        journal_entry_id: { type: string, format: uuid }
        line_no: { type: integer }
        account_id: { type: string, format: uuid }
        description: { type: string, nullable: true }
        debit: { type: number }
        credit: { type: number }
        currency_code: { type: string, example: "GHS" }
        fx_rate: { type: number }
        amount_base: { type: number }

    JournalGetResponse:
      type: object
      properties:
        journal: { $ref: "#/components/schemas/JournalEntry" }
        lines:
          type: array
          items: { $ref: "#/components/schemas/JournalLine" }

    VoidJournalRequest:
      type: object
      required: [reason]
      properties:
        reason: { type: string, example: "Test reversal" }

    VoidJournalResponse:
      type: object
      description: Implementation-specific; commonly includes reversalJournalId and updated status.
      additionalProperties: true

    TrialBalanceRow:
      type: object
      properties:
        account_id: { type: string, format: uuid }
        code: { type: string }
        name: { type: string }
        debit_total: { type: number }
        credit_total: { type: number }

    TrialBalanceResponse:
      type: array
      items: { $ref: "#/components/schemas/TrialBalanceRow" }

    AccountActivityRow:
      type: object
      properties:
        journal_id: { type: string, format: uuid }
        entry_no: { type: integer }
        entry_date: { type: string, format: date }
        memo: { type: string, nullable: true }
        status: { type: string, enum: [draft, posted, voided] }
        debit: { type: number }
        credit: { type: number }

    AccountActivityResponse:
      type: array
      items: { $ref: "#/components/schemas/AccountActivityRow" }
    # -------------------------
    # Phase 2: Business Ops (Tier 2)
    # -------------------------
    BusinessPartner:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        type: { type: string, enum: [customer, vendor] }
        code: { type: string, example: "CUST-0001" }
        name: { type: string, example: "Acme Trading Ltd" }
        status: { type: string, enum: [active, inactive], example: "active" }
        default_receivable_account_id: { type: string, format: uuid, nullable: true }
        default_payable_account_id: { type: string, format: uuid, nullable: true }
        payment_term_id: { type: string, format: uuid, nullable: true }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    CreateBusinessPartnerRequest:
      type: object
      required: [type, code, name]
      properties:
        type: { type: string, enum: [customer, vendor] }
        code: { type: string, example: "CUST-0001" }
        name: { type: string, example: "Acme Trading Ltd" }
        defaultReceivableAccountId: { type: string, format: uuid, nullable: true }
        defaultPayableAccountId: { type: string, format: uuid, nullable: true }
        paymentTermId: { type: string, format: uuid, nullable: true }
        status: { type: string, enum: [active, inactive], default: active }

    UpdateBusinessPartnerRequest:
      type: object
      properties:
        code: { type: string }
        name: { type: string }
        defaultReceivableAccountId: { type: string, format: uuid, nullable: true }
        defaultPayableAccountId: { type: string, format: uuid, nullable: true }
        paymentTermId: { type: string, format: uuid, nullable: true }
        status: { type: string, enum: [active, inactive] }

    PartnerContact:
      type: object
      properties:
        id: { type: string, format: uuid }
        partner_id: { type: string, format: uuid }
        name: { type: string, example: "Ama Mensah" }
        email: { type: string, example: "ama@example.com", nullable: true }
        phone: { type: string, example: "+233XXXXXXXXX", nullable: true }
        is_primary: { type: boolean, example: true }
        created_at: { type: string, format: date-time }

    UpsertPartnerContactRequest:
      type: object
      required: [name]
      properties:
        name: { type: string, example: "Ama Mensah" }
        email: { type: string, example: "ama@example.com", nullable: true }
        phone: { type: string, example: "+233XXXXXXXXX", nullable: true }
        isPrimary: { type: boolean, default: false }

    PartnerAddress:
      type: object
      properties:
        id: { type: string, format: uuid }
        partner_id: { type: string, format: uuid }
        line1: { type: string, example: "House 12, Ring Road" }
        line2: { type: string, nullable: true }
        city: { type: string, example: "Accra", nullable: true }
        region: { type: string, example: "Greater Accra", nullable: true }
        country_code: { type: string, example: "GH", nullable: true }
        postal_code: { type: string, nullable: true }
        is_primary: { type: boolean, example: true }
        created_at: { type: string, format: date-time }

    UpsertPartnerAddressRequest:
      type: object
      required: [line1]
      properties:
        line1: { type: string, example: "House 12, Ring Road" }
        line2: { type: string, nullable: true }
        city: { type: string, nullable: true }
        region: { type: string, nullable: true }
        countryCode: { type: string, nullable: true, example: "GH" }
        postalCode: { type: string, nullable: true }
        isPrimary: { type: boolean, default: false }

    PaymentTerm:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        name: { type: string, example: "Net 30" }
        net_days: { type: integer, example: 30 }
        discount_days: { type: integer, nullable: true }
        discount_rate: { type: number, nullable: true }
        is_default: { type: boolean, example: false }
        status: { type: string, enum: [active, inactive], example: "active" }
        created_at: { type: string, format: date-time }

    CreatePaymentTermRequest:
      type: object
      required: [name, netDays]
      properties:
        name: { type: string, example: "Net 30" }
        netDays: { type: integer, example: 30 }
        discountDays: { type: integer, nullable: true }
        discountRate: { type: number, nullable: true, example: 0.05 }
        isDefault: { type: boolean, default: false }
        status: { type: string, enum: [active, inactive], default: active }

    PaymentMethod:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        code: { type: string, example: "MOMO" }
        name: { type: string, example: "Mobile Money" }
        status: { type: string, enum: [active, inactive], example: "active" }
        created_at: { type: string, format: date-time }

    CreatePaymentMethodRequest:
      type: object
      required: [code, name]
      properties:
        code: { type: string, example: "MOMO" }
        name: { type: string, example: "Mobile Money" }
        status: { type: string, enum: [active, inactive], default: active }

    # -------------------------
    # Phase 2: Transactions (Tier 3) - Invoices
    # -------------------------
    Invoice:
      type: object
      properties:
        id: { type: string, format: uuid }
        organization_id: { type: string, format: uuid }
        customer_id: { type: string, format: uuid }
        invoice_no: { type: string, example: "INV-000001" }
        invoice_date: { type: string, format: date }
        due_date: { type: string, format: date }
        currency_code: { type: string, example: "GHS" }
        fx_rate: { type: number, example: 1 }
        status: { type: string, enum: [draft, issued, voided] }
        memo: { type: string, nullable: true }
        subtotal: { type: number }
        total: { type: number }
        period_id: { type: string, format: uuid, nullable: true }
        journal_entry_id: { type: string, format: uuid, nullable: true }
        issued_at: { type: string, format: date-time, nullable: true }
        issued_by: { type: string, format: uuid, nullable: true }
        voided_at: { type: string, format: date-time, nullable: true }
        voided_by: { type: string, format: uuid, nullable: true }
        void_reason: { type: string, nullable: true }
        reversal_journal_entry_id: { type: string, format: uuid, nullable: true }
        created_at: { type: string, format: date-time }
        updated_at: { type: string, format: date-time }

    InvoiceLine:
      type: object
      properties:
        id: { type: string, format: uuid }
        invoice_id: { type: string, format: uuid }
        line_no: { type: integer, example: 1 }
        description: { type: string, example: "Consulting services" }
        quantity: { type: number, example: 1 }
        unit_price: { type: number, example: 500 }
        line_total: { type: number, example: 500 }
        revenue_account_id: { type: string, format: uuid }

    CreateInvoiceLineRequest:
      type: object
      required: [description, quantity, unitPrice, revenueAccountId]
      properties:
        description: { type: string, example: "Consulting services" }
        quantity: { type: number, example: 1 }
        unitPrice: { type: number, example: 500 }
        revenueAccountId: { type: string, format: uuid }

    CreateInvoiceRequest:
      type: object
      required: [customerId, invoiceDate, dueDate, lines]
      properties:
        customerId: { type: string, format: uuid }
        invoiceDate: { type: string, format: date }
        dueDate: { type: string, format: date }
        memo: { type: string, nullable: true }
        lines:
          type: array
          minItems: 1
          items: { $ref: "#/components/schemas/CreateInvoiceLineRequest" }

    InvoiceDetailsResponse:
      type: object
      properties:
        invoice: { $ref: "#/components/schemas/Invoice" }
        lines:
          type: array
          items: { $ref: "#/components/schemas/InvoiceLine" }

    VoidInvoiceRequest:
      type: object
      required: [reason]
      properties:
        reason: { type: string, example: "Customer cancelled" }

security:
  - BearerAuth: []

paths:
  /auth/login:
    post:
      tags: [Auth]
      summary: Login (public)
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/LoginRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/LoginResponse" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"

  /core/permissions:
    get:
      tags: [Permissions]
      summary: List permissions
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Permission" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /core/roles:
    get:
      tags: [Roles]
      summary: List roles
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Role" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    post:
      tags: [Roles]
      summary: Create role
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateRoleRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Role" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /core/roles/{id}/permissions:
    post:
      tags: [Roles]
      summary: Attach permissions to role
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/AttachPermissionsRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AttachPermissionsResponse" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /core/users:
    get:
      tags: [Users]
      summary: List users in org
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/UserSummary" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    post:
      tags: [Users]
      summary: Create user in org
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateUserRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/UserSummary" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/users/{id}/disable:
    patch:
      tags: [Users]
      summary: Disable user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/UserSummary" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/users/{id}/roles:
    post:
      tags: [Users]
      summary: Assign roles to user
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/AssignRolesRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AssignRolesResponse" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /core/settings/{key}:
    get:
      tags: [Settings]
      summary: Get setting by key
      parameters:
        - in: path
          name: key
          required: true
          schema: { type: string }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Setting" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
    put:
      tags: [Settings]
      summary: Upsert setting by key
      parameters:
        - in: path
          name: key
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              additionalProperties: true
            examples:
              companyProfile:
                value: { name: "AptBooks Demo Org", tin: "GHA-123", address: "Accra" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Setting" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /core/accounting/periods:
    get:
      tags: [Periods]
      summary: List periods
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Period" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    post:
      tags: [Periods]
      summary: Create period
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreatePeriodRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Period" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/accounting/periods/{id}/close:
    post:
      tags: [Periods]
      summary: Close period
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Period" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /core/accounting/periods/{id}/reopen:
    post:
      tags: [Periods]
      summary: Reopen period
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Period" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /core/accounting/accounts:
    get:
      tags: [Chart of Accounts]
      summary: List chart of accounts
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Account" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    post:
      tags: [Chart of Accounts]
      summary: Create account
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateAccountRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Account" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/accounting/accounts/{id}:
    patch:
      tags: [Chart of Accounts]
      summary: Update account
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateAccountRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Account" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /core/accounting/journals:
    get:
      tags: [Journals]
      summary: List journals (optional filters)
      parameters:
        - in: query
          name: periodId
          schema: { type: string, format: uuid }
        - in: query
          name: status
          schema: { type: string, enum: [draft, posted, voided] }
        - in: query
          name: from
          schema: { type: string, format: date }
        - in: query
          name: to
          schema: { type: string, format: date }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/JournalEntry" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
    post:
      tags: [Journals]
      summary: Create draft journal
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateJournalRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/CreateJournalResponse" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/accounting/journals/{id}:
    get:
      tags: [Journals]
      summary: Get journal + lines
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/JournalGetResponse" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"

  /core/accounting/journals/{id}/post:
    post:
      tags: [Journals]
      summary: Post draft journal
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/accounting/journals/{id}/void:
    post:
      tags: [Journals]
      summary: Void posted journal by reversal
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/VoidJournalRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/VoidJournalResponse" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
        "404":
          $ref: "#/components/responses/NotFound"
        "409":
          $ref: "#/components/responses/Conflict"

  /core/accounting/balances/trial-balance:
    get:
      tags: [Balances]
      summary: Trial balance for a period
      parameters:
        - in: query
          name: periodId
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/TrialBalanceResponse" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /core/accounting/balances/gl:
    get:
      tags: [Balances]
      summary: General ledger balances for a period
      parameters:
        - in: query
          name: periodId
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  additionalProperties: true
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"

  /core/accounting/balances/account-activity:
    get:
      tags: [Balances]
      summary: Account activity within a date range
      parameters:
        - in: query
          name: accountId
          required: true
          schema: { type: string, format: uuid }
        - in: query
          name: from
          required: true
          schema: { type: string, format: date }
        - in: query
          name: to
          required: true
          schema: { type: string, format: date }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/AccountActivityResponse" }
        "401":
          $ref: "#/components/responses/Unauthorized"
        "403":
          $ref: "#/components/responses/Forbidden"
  # =========================
  # Phase 2: Tier 2 - Business Ops
  # =========================

  /modules/business/partners:
    get:
      tags: [Business Partners]
      summary: List business partners
      parameters:
        - in: query
          name: type
          schema: { type: string, enum: [customer, vendor] }
        - in: query
          name: status
          schema: { type: string, enum: [active, inactive] }
        - in: query
          name: q
          schema: { type: string, description: "Search by code/name (implementation-specific)" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/BusinessPartner" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

    post:
      tags: [Business Partners]
      summary: Create business partner
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateBusinessPartnerRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BusinessPartner" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "409": { $ref: "#/components/responses/Conflict" }

  /modules/business/partners/{id}:
    get:
      tags: [Business Partners]
      summary: Get partner by id
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BusinessPartner" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

    patch:
      tags: [Business Partners]
      summary: Update partner
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpdateBusinessPartnerRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/BusinessPartner" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /modules/business/partners/{id}/contacts:
    post:
      tags: [Business Partners]
      summary: Upsert partner contact (supports primary contact)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpsertPartnerContactRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PartnerContact" }
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PartnerContact" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /modules/business/partners/{id}/addresses:
    post:
      tags: [Business Partners]
      summary: Upsert partner address (supports primary address)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/UpsertPartnerAddressRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PartnerAddress" }
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PartnerAddress" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /modules/business/payment-config/payment-terms:
    get:
      tags: [Payment Config]
      summary: List payment terms
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/PaymentTerm" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

    post:
      tags: [Payment Config]
      summary: Create payment term
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreatePaymentTermRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PaymentTerm" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "409": { $ref: "#/components/responses/Conflict" }

  /modules/business/payment-config/payment-methods:
    get:
      tags: [Payment Config]
      summary: List payment methods
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/PaymentMethod" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

    post:
      tags: [Payment Config]
      summary: Create payment method
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreatePaymentMethodRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/PaymentMethod" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "409": { $ref: "#/components/responses/Conflict" }

  # =========================
  # Phase 2: Tier 3 - Transactions (Invoices)
  # =========================

  /modules/transactions/invoices:
    get:
      tags: [Invoices]
      summary: List invoices
      parameters:
        - in: query
          name: status
          schema: { type: string, enum: [draft, issued, voided] }
        - in: query
          name: customerId
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: array
                items: { $ref: "#/components/schemas/Invoice" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }

    post:
      tags: [Invoices]
      summary: Create draft invoice
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/CreateInvoiceRequest" }
      responses:
        "201":
          description: Created
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Invoice" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "409": { $ref: "#/components/responses/Conflict" }

  /modules/transactions/invoices/{id}:
    get:
      tags: [Invoices]
      summary: Get invoice + lines
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/InvoiceDetailsResponse" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }

  /modules/transactions/invoices/{id}/issue:
    post:
      tags: [Invoices]
      summary: Issue invoice (posts journal via kernel interface)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Invoice" }
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
        "409": { $ref: "#/components/responses/Conflict" }

  /modules/transactions/invoices/{id}/void:
    post:
      tags: [Invoices]
      summary: Void issued invoice (reversal journal)
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string, format: uuid }
      requestBody:
        required: true
        content:
          application/json:
            schema: { $ref: "#/components/schemas/VoidInvoiceRequest" }
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                type: object
                additionalProperties: true
        "400":
          description: Bad request
          content:
            application/json:
              schema: { $ref: "#/components/schemas/Error" }
        "401": { $ref: "#/components/responses/Unauthorized" }
        "403": { $ref: "#/components/responses/Forbidden" }
        "404": { $ref: "#/components/responses/NotFound" }
        "409": { $ref: "#/components/responses/Conflict" }
